[server]
domain = ${domain}
root_url = https://${domain}
enable_gzip = true

[database]
type = postgres
host = ${db_host}:5432
name = grafana
user = grafana
password = ${db_password}
ssl_mode = require
max_open_conn = 100
max_idle_conn = 100
conn_max_lifetime = 14400

[auth]
disable_login_form = false
oauth_auto_login = true

[auth.azuread]
enabled = true
name = Azure AD
allow_sign_up = true
client_id = ${azure_client_id}
client_secret = ${azure_client_secret}
scopes = openid email profile
auth_url = https://login.microsoftonline.com/${azure_tenant_id}/oauth2/v2.0/authorize
token_url = https://login.microsoftonline.com/${azure_tenant_id}/oauth2/v2.0/token
api_url = https://graph.microsoft.com/v1.0/me
allowed_domains = oversight.com
role_attribute_path = contains(groups[*], 'Admin') && 'Admin' || 'Viewer'

[analytics]
reporting_enabled = false
check_for_updates = false

[log]
mode = console
level = info

[alerting]
enabled = true
execute_alerts = true

[unified_alerting]
enabled = true
ha_peers = grafana-0.grafana-headless:9094,grafana-1.grafana-headless:9094,grafana-2.grafana-headless:9094
ha_listen_address = 0.0.0.0:9094

[security]
admin_user = admin
disable_gravatar = true
cookie_secure = true
cookie_samesite = lax
strict_transport_security = true
strict_transport_security_max_age_seconds = 86400
strict_transport_security_preload = true
strict_transport_security_subdomains = true
x_content_type_options = true
x_xss_protection = true

[users]
allow_sign_up = false
allow_org_create = false
auto_assign_org = true
auto_assign_org_role = Viewer

[paths]
data = /var/lib/grafana
logs = /var/log/grafana
plugins = /var/lib/grafana/plugins
provisioning = /etc/grafana/provisioning